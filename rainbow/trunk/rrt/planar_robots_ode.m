% function x_dot = planar_robots_ode(x, u)
% % Robot parameters
% theta = [2; 1; 0.5; 0.25; 1.5; 1; 0.25; 0.2*ones(6,1); 0.1*ones(6,1); 10];
% 
% % Compute x_dot
% x_dot = zeros(size(x));
% x_dot(1:6,1) = x(7:12,1);
% x_dot(7:12,1) = planar_robots_eom(u, x(1:6,1), x(7:12,1), theta);
function xdot = planar_robots_ode(sol)
% Robot parameters
theta = [2; 1; 0.5; 0.25; 1.5; 1; 0.25; 0.2*ones(6,1); 0.1*ones(6,1); 10];

% get size of states
xdot(:,1:6) = sol.states(:,7:12);
xdot(:,7:9) = accel(sol.states(:,1:3),sol.states(:,7:9),sol.controls(:,1:3));
xdot(:,10:12) = accel(sol.states(:,4:6),sol.states(:,10:12),sol.controls(:,4:6));

function Up = accel(Q,Qp,T)
G = 9.81;

Q1 = Q(:,1);
Q2 = Q(:,2);
Q3 = Q(:,3);
U1 = Qp(:,1);
U2 = Qp(:,2);
U3 = Qp(:,3);

T1 = T(:,1);
T2 = T(:,2);
T3 = T(:,3);

TF1 = 38*U1 + 8.210000000000001*tanh(10*U1);
TF2 = 9.029999999999999*U2 + 8.48*tanh(10*U2);
TF3 = 3.97*U3 + 7.05*tanh(10*U3);

U1p = -0.8040935672514625.*(1.478793819063225.*(2.133333333333333.*(-27.26693495131058+cos(Q3)).*(1-1.268361170346627.*cos(Q3)-1.189088597199963.*cos(Q2+Q3))+(1- ...
  1.268361170346627.*cos(Q3)).*(58.16946122946257+44.89558270676692.*cos(Q2)-2.133333333333333.*cos(Q3)-cos(Q2+Q3))).*(34.80924533556114.*TF3+2.222222222222223.* ...
  G.*sin(Q1+Q2+Q3)-34.80924533556114.*T3-sin(Q2+Q3).*pow(U1,2)-1.066666666666667.*sin(Q3).*pow((U1+U2),2))+(69.16864305321926+53.38482546126438.*cos(Q2)-2.536722340693253.* ...
  cos(Q3)-1.189088597199963.*cos(Q2+Q3)-(1-1.268361170346627.*cos(Q3)).*(1-1.268361170346627.*cos(Q3)-1.189088597199963.*cos(Q2+Q3))).*(43.29004329004327.* ...
  T2+59.24389610389608.*G.*sin(Q1+Q2)+G.*(sin(Q1+Q2+Q3)+21.81818181818181.*sin(Q1+Q2))+3.763636363636362.*G.*(11.42857142857143.*sin(Q1+Q2)-sin(Q1+Q2+Q3))+ ...
  1.243636363636363.*sin(Q2+Q3).*pow(U1,2)+1.326545454545454.*sin(Q3).*pow((U1+U2),2)-43.29004329004327.*TF2-55.83377922077919.*sin(Q2).*pow(U1,2)-1.326545454545454.* ...
  sin(Q3).*pow((U1+U2+U3),2))+43.29004329004327.*(-69.16864305321926+2.536722340693253.*cos(Q3)+pow((1-1.268361170346627.*cos(Q3)),2)).*(T1+0.23571.*G.*(sin(Q1+Q2)+ ...
  9.278350515463918.*sin(Q1))+0.3729.*G.*(4.300000000000001.*sin(Q1)-cos(Q1))+1.132824.*G.*(sin(Q1+Q2)+1.223491027732464.*sin(Q1))+0.02310000000000001.*G.*( ...
  20.45454545454545.*sin(Q1)+sin(Q1+Q2+Q3)+21.81818181818181.*sin(Q1+Q2))+0.08694.*G.*(10.71428571428571.*sin(Q1)+11.42857142857143.*sin(Q1+Q2)-sin(Q1+Q2+ ...
  Q3))+5.390653201597928E-18.*pow(U1,2)+0.02872799999999999.*sin(Q2+Q3).*pow(U1,2)+0.03064319999999999.*sin(Q3).*pow((U1+U2),2)+1.2897603.*sin(Q2).*pow((U1+U2), ...
  2)-TF1-1.2897603.*sin(Q2).*pow(U1,2)-0.03064319999999999.*sin(Q3).*pow((U1+U2+U3),2)-0.02872799999999999.*sin(Q2+Q3).*pow((U1+U2+U3),2)))./((1-1.268361170346627.* ...
  cos(Q3)-1.189088597199963.*cos(Q2+Q3)).*(2.133333333333333.*(-27.26693495131058+cos(Q3)).*(1-1.268361170346627.*cos(Q3)-1.189088597199963.*cos(Q2+Q3))+(1- ...
  1.268361170346627.*cos(Q3)).*(58.16946122946257+44.89558270676692.*cos(Q2)-2.133333333333333.*cos(Q3)-cos(Q2+Q3)))-1.189088597199962.*pow((58.16946122946257+ ...
  44.89558270676692.*cos(Q2)-2.133333333333333.*cos(Q3)-cos(Q2+Q3)),2)-5.073444681386506.*(-27.26693495131058+cos(Q3)).*(80.38806934349766+44.89558270676692.*cos(Q2)- ...
  1.066666666666667.*cos(Q3)-cos(Q2+Q3))-(1-1.268361170346627.*cos(Q3)).*(2.*(1-1.268361170346627.*cos(Q3)).*(80.38806934349766+44.89558270676692.*cos(Q2)- ...
  1.066666666666667.*cos(Q3)-cos(Q2+Q3))-(1-1.268361170346627.*cos(Q3)-1.189088597199963.*cos(Q2+Q3)).*(58.16946122946257+44.89558270676692.*cos(Q2)-2.133333333333333.*cos(Q3)-cos(Q2+Q3))));

U2p = 0.8040935672514625.*(1.478793819063225.*(2.*(1-1.268361170346627.*cos(Q3)).*(80.38806934349766+44.89558270676692.*cos(Q2)-1.066666666666667.*cos(Q3)-cos( ...
  Q2+Q3))-(1-1.268361170346627.*cos(Q3)-1.189088597199963.*cos(Q2+Q3)).*(58.16946122946257+44.89558270676692.*cos(Q2)-2.133333333333333.*cos(Q3)-cos(Q2+Q3))).*(34.80924533556114.* ...
  TF3+2.222222222222223.*G.*sin(Q1+Q2+Q3)-34.80924533556114.*T3-sin(Q2+Q3).*pow(U1,2)-1.066666666666667.*sin(Q3).*pow((U1+U2),2))+(191.1770732145459+106.7696509225288.* ...
  cos(Q2)-2.536722340693253.*cos(Q3)-2.378177194399926.*cos(Q2+Q3)-pow((1-1.268361170346627.*cos(Q3)-1.189088597199963.*cos(Q2+Q3)),2)).*(43.29004329004327.* ...
  T2+59.24389610389608.*G.*sin(Q1+Q2)+G.*(sin(Q1+Q2+Q3)+21.81818181818181.*sin(Q1+Q2))+3.763636363636362.*G.*(11.42857142857143.*sin(Q1+Q2)-sin(Q1+Q2+Q3))+ ...
  1.243636363636363.*sin(Q2+Q3).*pow(U1,2)+1.326545454545454.*sin(Q3).*pow((U1+U2),2)-43.29004329004327.*TF2-55.83377922077919.*sin(Q2).*pow(U1,2)-1.326545454545454.* ...
  sin(Q3).*pow((U1+U2+U3),2))-43.29004329004327.*(69.16864305321926+53.38482546126438.*cos(Q2)-2.536722340693253.*cos(Q3)-1.189088597199963.*cos(Q2+Q3)-(1-1.268361170346627.* ...
  cos(Q3)).*(1-1.268361170346627.*cos(Q3)-1.189088597199963.*cos(Q2+Q3))).*(T1+0.23571.*G.*(sin(Q1+Q2)+9.278350515463918.*sin(Q1))+0.3729.*G.*(4.300000000000001.* ...
  sin(Q1)-cos(Q1))+1.132824.*G.*(sin(Q1+Q2)+1.223491027732464.*sin(Q1))+0.02310000000000001.*G.*(20.45454545454545.*sin(Q1)+sin(Q1+Q2+Q3)+21.81818181818181.*sin(Q1+Q2))+ ...
  0.08694.*G.*(10.71428571428571.*sin(Q1)+11.42857142857143.*sin(Q1+Q2)-sin(Q1+Q2+Q3))+5.390653201597928E-18.*pow(U1,2)+0.02872799999999999.*sin(Q2+Q3).*pow(U1, ...
  2)+0.03064319999999999.*sin(Q3).*pow((U1+U2),2)+1.2897603.*sin(Q2).*pow((U1+U2),2)-TF1-1.2897603.*sin(Q2).*pow(U1,2)-0.03064319999999999.*sin(Q3).*pow((U1+U2+ ...
  U3),2)-0.02872799999999999.*sin(Q2+Q3).*pow((U1+U2+U3),2)))./((1-1.268361170346627.*cos(Q3)-1.189088597199963.*cos(Q2+Q3)).*(2.133333333333333.*(-27.26693495131058+ ...
  cos(Q3)).*(1-1.268361170346627.*cos(Q3)-1.189088597199963.*cos(Q2+Q3))+(1-1.268361170346627.*cos(Q3)).*(58.16946122946257+44.89558270676692.*cos(Q2)- ...
  2.133333333333333.*cos(Q3)-cos(Q2+Q3)))-1.189088597199962.*pow((58.16946122946257+44.89558270676692.*cos(Q2)-2.133333333333333.*cos(Q3)-cos(Q2+Q3)),2)-5.073444681386506.*( ...
  -27.26693495131058+cos(Q3)).*(80.38806934349766+44.89558270676692.*cos(Q2)-1.066666666666667.*cos(Q3)-cos(Q2+Q3))-(1-1.268361170346627.*cos(Q3)).*(2.*(1- ...
  1.268361170346627.*cos(Q3)).*(80.38806934349766+44.89558270676692.*cos(Q2)-1.066666666666667.*cos(Q3)-cos(Q2+Q3))-(1-1.268361170346627.*cos(Q3)-1.189088597199963.* ...
  cos(Q2+Q3)).*(58.16946122946257+44.89558270676692.*cos(Q2)-2.133333333333333.*cos(Q3)-cos(Q2+Q3))));

U3p = -0.9561384919005553.*((2.*(1-1.268361170346627.*cos(Q3)).*(80.38806934349766+44.89558270676692.*cos(Q2)-1.066666666666667.*cos(Q3)-cos(Q2+Q3))-(1-1.268361170346627.* ...
  cos(Q3)-1.189088597199963.*cos(Q2+Q3)).*(58.16946122946257+44.89558270676692.*cos(Q2)-2.133333333333333.*cos(Q3)-cos(Q2+Q3))).*(43.29004329004327.*T2+59.24389610389608.* ...
  G.*sin(Q1+Q2)+G.*(sin(Q1+Q2+Q3)+21.81818181818181.*sin(Q1+Q2))+3.763636363636362.*G.*(11.42857142857143.*sin(Q1+Q2)-sin(Q1+Q2+Q3))+1.243636363636363.*sin(Q2+Q3).* ...
  pow(U1,2)+1.326545454545454.*sin(Q3).*pow((U1+U2),2)-43.29004329004327.*TF2-55.83377922077919.*sin(Q2).*pow(U1,2)-1.326545454545454.*sin(Q3).*pow((U1+U2+U3), ...
  2))-1.478793819063225.*(pow((58.16946122946257+44.89558270676692.*cos(Q2)-2.133333333333333.*cos(Q3)-cos(Q2+Q3)),2)+4.266666666666666.*(-27.26693495131058+ ...
  cos(Q3)).*(80.38806934349766+44.89558270676692.*cos(Q2)-1.066666666666667.*cos(Q3)-cos(Q2+Q3))).*(34.80924533556114.*TF3+2.222222222222223.*G.*sin(Q1+Q2+Q3)- ...
  34.80924533556114.*T3-sin(Q2+Q3).*pow(U1,2)-1.066666666666667.*sin(Q3).*pow((U1+U2),2))-43.29004329004327.*(2.133333333333333.*(-27.26693495131058+cos(Q3)).*( ...
  1-1.268361170346627.*cos(Q3)-1.189088597199963.*cos(Q2+Q3))+(1-1.268361170346627.*cos(Q3)).*(58.16946122946257+44.89558270676692.*cos(Q2)-2.133333333333333.*cos( ...
  Q3)-cos(Q2+Q3))).*(T1+0.23571.*G.*(sin(Q1+Q2)+9.278350515463918.*sin(Q1))+0.3729.*G.*(4.300000000000001.*sin(Q1)-cos(Q1))+1.132824.*G.*(sin(Q1+Q2)+1.223491027732464.* ...
  sin(Q1))+0.02310000000000001.*G.*(20.45454545454545.*sin(Q1)+sin(Q1+Q2+Q3)+21.81818181818181.*sin(Q1+Q2))+0.08694.*G.*(10.71428571428571.*sin(Q1)+11.42857142857143.* ...
  sin(Q1+Q2)-sin(Q1+Q2+Q3))+5.390653201597928E-18.*pow(U1,2)+0.02872799999999999.*sin(Q2+Q3).*pow(U1,2)+0.03064319999999999.*sin(Q3).*pow((U1+U2),2)+1.2897603.* ...
  sin(Q2).*pow((U1+U2),2)-TF1-1.2897603.*sin(Q2).*pow(U1,2)-0.03064319999999999.*sin(Q3).*pow((U1+U2+U3),2)-0.02872799999999999.*sin(Q2+Q3).*pow((U1+U2+U3),2)))./(( ...
  1-1.268361170346627.*cos(Q3)-1.189088597199963.*cos(Q2+Q3)).*(2.133333333333333.*(-27.26693495131058+cos(Q3)).*(1-1.268361170346627.*cos(Q3)-1.189088597199963.* ...
  cos(Q2+Q3))+(1-1.268361170346627.*cos(Q3)).*(58.16946122946257+44.89558270676692.*cos(Q2)-2.133333333333333.*cos(Q3)-cos(Q2+Q3)))-1.189088597199962.*pow(( ...
  58.16946122946257+44.89558270676692.*cos(Q2)-2.133333333333333.*cos(Q3)-cos(Q2+Q3)),2)-5.073444681386506.*(-27.26693495131058+cos(Q3)).*(80.38806934349766+ ...
  44.89558270676692.*cos(Q2)-1.066666666666667.*cos(Q3)-cos(Q2+Q3))-(1-1.268361170346627.*cos(Q3)).*(2.*(1-1.268361170346627.*cos(Q3)).*(80.38806934349766+44.89558270676692.* ...
  cos(Q2)-1.066666666666667.*cos(Q3)-cos(Q2+Q3))-(1-1.268361170346627.*cos(Q3)-1.189088597199963.*cos(Q2+Q3)).*(58.16946122946257+44.89558270676692.*cos(Q2)-2.133333333333333.*cos(Q3)-cos(Q2+Q3))));

Up = [U1p, U2p, U3p];

function y = pow(x,n)
y = x.^n;